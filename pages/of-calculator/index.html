import React, { useState, useMemo, useEffect } from 'react';
import { 
  Plus, 
  Trash2, 
  TrendingUp, 
  TrendingDown, 
  DollarSign, 
  Activity,
  Menu,
  X,
  PieChart,
  Save,
  RefreshCw
} from 'lucide-react';

/**
 * CUSTOM DESIGN TOKENS
 * Preserving the user's specific color palette from the uploaded backbone.
 */
const THEME = {
  colors: {
    primary: '#0A091B',
    surface: '#111827',
    surfaceHighlight: '#1F2937',
    teal: '#2DD4BF',
    emerald: '#10B981',
    blue: '#60A5FA',
    danger: '#EF4444',
    textMain: '#E5E7EB',
    textMuted: '#9CA3AF'
  }
};

const Card = ({ children, className = "" }) => (
  <div className={`bg-gray-900/50 backdrop-blur-sm border border-white/5 rounded-xl p-6 hover:border-teal-500/20 transition-all duration-300 ${className}`}>
    {children}
  </div>
);

// Badge component removed as it is no longer used in the main view, 
// but kept in code if needed later for other status indicators.
const Badge = ({ children, type = "neutral" }) => {
  const styles = {
    success: "bg-emerald-500/10 text-emerald-400 border-emerald-500/20",
    danger: "bg-red-500/10 text-red-400 border-red-500/20",
    neutral: "bg-gray-700/30 text-gray-300 border-gray-600/30",
    brand: "bg-teal-500/10 text-teal-400 border-teal-500/20"
  };
  return (
    <span className={`px-2 py-1 rounded-md text-xs font-bold uppercase tracking-wider border ${styles[type]}`}>
      {children}
    </span>
  );
};

export default function App() {
  // --- STATE MANAGEMENT ---
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [taxRate, setTaxRate] = useState(20);
  
  const [incomes, setIncomes] = useState([
    { id: 1, label: 'Main Contract', amount: 8500 },
    { id: 2, label: 'Consulting', amount: 1200 }
  ]);
  
  const [expenses, setExpenses] = useState([
    { id: 1, label: 'Server Costs', amount: 450 },
    { id: 2, label: 'Software Licenses', amount: 120 },
    { id: 3, label: 'Office Lease', amount: 2000 }
  ]);

  // --- SEO & METADATA INJECTION ---
  useEffect(() => {
    // Dynamically update document title for SEO
    document.title = "Profit & Tax Dashboard | Profitnet Financial Tools";
    
    // Update or create meta description
    let metaDesc = document.querySelector('meta[name="description"]');
    if (!metaDesc) {
      metaDesc = document.createElement('meta');
      metaDesc.name = "description";
      document.head.appendChild(metaDesc);
    }
    metaDesc.content = "Real-time profit and tax projection dashboard for nonprofits and businesses. Calculate gross revenue, expenses, and net profit margins instantly.";
  }, []);

  // --- CALCULATIONS (useMemo for Performance) ---
  const totalIncome = useMemo(() => incomes.reduce((acc, curr) => acc + (parseFloat(curr.amount) || 0), 0), [incomes]);
  const totalExpenses = useMemo(() => expenses.reduce((acc, curr) => acc + (parseFloat(curr.amount) || 0), 0), [expenses]);
  
  const grossProfit = totalIncome - totalExpenses;
  const taxAmount = grossProfit > 0 ? (grossProfit * (taxRate / 100)) : 0;
  const netProfit = grossProfit - taxAmount;
  const profitMargin = totalIncome > 0 ? ((netProfit / totalIncome) * 100).toFixed(1) : 0;

  // --- HANDLERS ---
  const handleAddIncome = () => {
    setIncomes([...incomes, { id: Date.now(), label: 'New Revenue', amount: 0 }]);
  };

  const handleRemoveIncome = (id) => {
    setIncomes(incomes.filter(i => i.id !== id));
  };

  const handleUpdateIncome = (id, field, value) => {
    setIncomes(incomes.map(i => i.id === id ? { ...i, [field]: value } : i));
  };

  const handleAddExpense = () => {
    setExpenses([...expenses, { id: Date.now(), label: 'New Expense', amount: 0 }]);
  };

  const handleRemoveExpense = (id) => {
    setExpenses(expenses.filter(e => e.id !== id));
  };

  const handleUpdateExpense = (id, field, value) => {
    setExpenses(expenses.map(e => e.id === id ? { ...e, [field]: value } : e));
  };

  // Prevent scrolling when mobile menu is open
  useEffect(() => {
    if (isMenuOpen) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = 'unset';
    }
    return () => { document.body.style.overflow = 'unset'; };
  }, [isMenuOpen]);

  // Currency Formatter
  const formatCurrency = (val) => {
    return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(val);
  };

  return (
    <div className="min-h-screen bg-[#0A091B] text-gray-200 font-sans selection:bg-teal-500/30 selection:text-teal-200 overflow-x-hidden">
      
      {/* --- CSS & GLOBAL STYLES INJECTION --- */}
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        .hero-glow {
          background: radial-gradient(circle at 30% 20%, rgba(45, 212, 191, 0.15) 0%, transparent 60%),
                      radial-gradient(circle at 70% 80%, rgba(96, 165, 250, 0.1) 0%, transparent 60%);
          will-change: opacity;
        }
        
        .bg-grid-pattern {
          background-image: linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                            linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
          background-size: 2.5rem 2.5rem;
        }
        
        /* Remove arrows from number inputs */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
      `}</style>

      {/* --- BACKGROUND EFFECTS --- */}
      <div className="fixed inset-0 z-0 pointer-events-none">
        <div className="absolute inset-0 bg-grid-pattern opacity-40"></div>
        <div className="absolute inset-0 hero-glow animate-pulse"></div>
      </div>

      {/* --- NAVIGATION --- */}
      <header className="fixed w-full top-0 z-50 bg-[#0A091B]/80 backdrop-blur-md border-b border-white/5">
        <div className="container mx-auto px-6 py-4 flex justify-between items-center">
          {/* Logo - Added Alt Text for SEO */}
          <a href="#" className="flex items-center space-x-3 group" aria-label="Profitnet Homepage">
            <img 
              src="https://emerald-urgent-cuckoo-166.mypinata.cloud/ipfs/bafybeibelhobbfhgcur4j5qmnzvnjlfkpwawy3rttzdnfr4t22ikcj263m" 
              className="h-8 w-8 transition-transform group-hover:rotate-12" 
              alt="Profitnet Logo"
              width="32"
              height="32"
            />
            <span className="text-xl font-bold tracking-tight text-white">Profitnet</span>
          </a>

          {/* Desktop Nav */}
          <nav className="hidden lg:flex space-x-10 items-center">
            <a href="#" className="text-sm font-bold text-white hover:text-[#2DD4BF] transition-colors duration-200">HOME</a>
            <a href="#" className="text-xs font-bold uppercase tracking-widest text-[#2DD4BF] hover:text-emerald-300 transition-colors duration-200">Landmarks</a>
            <button className="px-6 py-2 rounded-full border border-teal-500/30 text-[10px] font-black text-teal-400 hover:bg-teal-500/10 transition-all duration-300 uppercase tracking-[0.2em] shadow-[0_0_15px_rgba(45,212,191,0.1)]">
              $PNET Asset Dashboard
            </button>
          </nav>

          {/* Mobile Menu Toggle - Added touch manipulation for faster response */}
          <button 
            onClick={() => setIsMenuOpen(!isMenuOpen)}
            className="lg:hidden text-white p-2 hover:bg-white/5 rounded-lg transition-colors touch-manipulation"
            aria-label="Toggle Menu"
          >
            {isMenuOpen ? <X size={24} /> : <Menu size={24} />}
          </button>
        </div>

        {/* Mobile Menu Overlay */}
        <div className={`fixed inset-0 bg-[#0A091B]/95 backdrop-blur-xl z-40 lg:hidden flex flex-col items-center justify-center space-y-8 transition-all duration-300 ${isMenuOpen ? 'opacity-100 translate-y-0 pointer-events-auto' : 'opacity-0 -translate-y-full pointer-events-none'}`}>
          <a href="#" className="text-xl font-black text-white uppercase tracking-widest" onClick={() => setIsMenuOpen(false)}>Home</a>
          <a href="#" className="text-xl font-black text-[#2DD4BF] uppercase tracking-widest" onClick={() => setIsMenuOpen(false)}>Landmarks</a>
          <a href="#" className="text-xl font-black text-white uppercase tracking-widest" onClick={() => setIsMenuOpen(false)}>$PNET Dashboard</a>
        </div>
      </header>

      {/* --- MAIN DASHBOARD CONTENT --- */}
      <main className="relative z-10 pt-32 pb-20 container mx-auto px-6 max-w-7xl">
        
        {/* Header Section - Simplified & Badges Removed */}
        <div className="flex flex-col md:flex-row justify-between items-start md:items-end mb-10 space-y-6 md:space-y-0">
          <div>
            <h1 className="text-4xl md:text-5xl font-black text-white tracking-tight">
              Profit <span className="text-[#2DD4BF]">&</span> Tax
            </h1>
            <p className="text-gray-400 mt-2 max-w-lg">
              Real-time projection of your nonprofit or business financials.
            </p>
          </div>
          <div className="flex gap-3 w-full md:w-auto">
             <button 
                onClick={() => { setIncomes([]); setExpenses([]); }}
                className="flex-1 md:flex-none justify-center touch-manipulation flex items-center gap-2 px-4 py-3 md:py-2 rounded-lg bg-white/5 hover:bg-white/10 text-sm font-semibold transition-colors border border-white/5 text-gray-300"
              >
               <RefreshCw size={16} /> Reset
             </button>
             <button className="flex-1 md:flex-none justify-center touch-manipulation flex items-center gap-2 px-4 py-3 md:py-2 rounded-lg bg-[#2DD4BF] hover:bg-[#2DD4BF]/90 text-[#0A091B] text-sm font-bold transition-colors shadow-[0_0_20px_rgba(45,212,191,0.3)]">
               <Save size={16} /> Save Report
             </button>
          </div>
        </div>

        {/* Top Stats Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
          
          <Card className="relative overflow-hidden group">
            <div className="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
              <TrendingUp size={48} />
            </div>
            <p className="text-sm font-bold text-gray-500 uppercase tracking-wider">Gross Revenue</p>
            <p className="text-3xl font-black text-white mt-1">{formatCurrency(totalIncome)}</p>
            <div className="mt-4 h-1 w-full bg-gray-800 rounded-full overflow-hidden">
              <div className="h-full bg-blue-500 w-full"></div>
            </div>
          </Card>

          <Card className="relative overflow-hidden group">
            <div className="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
              <TrendingDown size={48} />
            </div>
            <p className="text-sm font-bold text-gray-500 uppercase tracking-wider">Total Expenses</p>
            <p className="text-3xl font-black text-white mt-1">{formatCurrency(totalExpenses)}</p>
            <div className="mt-4 h-1 w-full bg-gray-800 rounded-full overflow-hidden">
              <div 
                className="h-full bg-red-500 transition-all duration-500" 
                style={{ width: `${Math.min((totalExpenses / (totalIncome || 1)) * 100, 100)}%` }}
              ></div>
            </div>
          </Card>

          <Card className="relative overflow-hidden group border-[#2DD4BF]/30 bg-[#2DD4BF]/5">
            <div className="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
              <Activity size={48} className="text-[#2DD4BF]" />
            </div>
            <p className="text-sm font-bold text-[#2DD4BF] uppercase tracking-wider">Net Profit</p>
            <p className={`text-3xl font-black mt-1 ${netProfit >= 0 ? 'text-white' : 'text-red-400'}`}>
              {formatCurrency(netProfit)}
            </p>
            <div className="flex items-center gap-2 mt-4 text-xs font-bold text-emerald-400">
               <span className="bg-emerald-500/10 px-2 py-0.5 rounded border border-emerald-500/20">
                 {profitMargin}% Margin
               </span>
            </div>
          </Card>

          <Card className="relative overflow-hidden group">
            <div className="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
              <DollarSign size={48} />
            </div>
            <p className="text-sm font-bold text-gray-500 uppercase tracking-wider">Est. Taxes</p>
            <p className="text-3xl font-black text-white mt-1">{formatCurrency(taxAmount)}</p>
            <div className="mt-4 text-xs text-gray-400">
              Based on {taxRate}% rate
            </div>
          </Card>

        </div>

        {/* Split View: Inputs & Tax Logic */}
        <div className="grid lg:grid-cols-3 gap-8">
          
          {/* LEFT: Income & Expense Inputs */}
          <div className="lg:col-span-2 space-y-8">
            
            {/* Income Section */}
            <section className="bg-gray-900/40 border border-white/5 rounded-2xl p-6" aria-label="Income Sources">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold text-white flex items-center gap-2">
                  <span className="w-2 h-6 bg-blue-500 rounded-full"></span>
                  Revenue Streams
                </h3>
                <button 
                  onClick={handleAddIncome}
                  className="p-3 md:p-2 bg-blue-500/10 hover:bg-blue-500/20 text-blue-400 rounded-lg transition-colors touch-manipulation"
                  aria-label="Add Income Stream"
                >
                  <Plus size={20} />
                </button>
              </div>

              <div className="space-y-3">
                {incomes.map((item) => (
                  <div key={item.id} className="group flex flex-col md:flex-row items-stretch md:items-center gap-4 bg-[#0A091B] p-3 rounded-xl border border-white/5 hover:border-blue-500/30 transition-all">
                    <input 
                      type="text" 
                      value={item.label}
                      onChange={(e) => handleUpdateIncome(item.id, 'label', e.target.value)}
                      className="bg-transparent border-none text-gray-300 focus:ring-0 w-full font-medium text-base p-2"
                      placeholder="Source Name"
                      aria-label="Income Source Name"
                    />
                    <div className="flex justify-between items-center gap-4">
                        <div className="flex items-center gap-2 bg-gray-800/50 px-3 py-2 rounded-lg border border-white/5 flex-1 md:flex-none">
                        <span className="text-gray-500 text-sm">$</span>
                        <input 
                            type="number" 
                            value={item.amount}
                            onChange={(e) => handleUpdateIncome(item.id, 'amount', e.target.value)}
                            className="bg-transparent border-none text-white focus:ring-0 w-full md:w-24 text-right font-bold tabular-nums text-base"
                            placeholder="0.00"
                            aria-label="Income Amount"
                        />
                        </div>
                        <button 
                        onClick={() => handleRemoveIncome(item.id)}
                        className="text-gray-600 hover:text-red-400 transition-colors p-2"
                        aria-label="Remove Income"
                        >
                        <Trash2 size={20} />
                        </button>
                    </div>
                  </div>
                ))}
                {incomes.length === 0 && (
                  <div className="text-center py-8 text-gray-500 italic text-sm border-2 border-dashed border-gray-800 rounded-xl">
                    No income streams added.
                  </div>
                )}
              </div>
            </section>

            {/* Expenses Section */}
            <section className="bg-gray-900/40 border border-white/5 rounded-2xl p-6" aria-label="Expenses">
              <div className="flex justify-between items-center mb-6">
                <h3 className="text-xl font-bold text-white flex items-center gap-2">
                  <span className="w-2 h-6 bg-red-500 rounded-full"></span>
                  Expenses
                </h3>
                <button 
                  onClick={handleAddExpense}
                  className="p-3 md:p-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors touch-manipulation"
                  aria-label="Add Expense"
                >
                  <Plus size={20} />
                </button>
              </div>

              <div className="space-y-3">
                {expenses.map((item) => (
                  <div key={item.id} className="group flex flex-col md:flex-row items-stretch md:items-center gap-4 bg-[#0A091B] p-3 rounded-xl border border-white/5 hover:border-red-500/30 transition-all">
                    <input 
                      type="text" 
                      value={item.label}
                      onChange={(e) => handleUpdateExpense(item.id, 'label', e.target.value)}
                      className="bg-transparent border-none text-gray-300 focus:ring-0 w-full font-medium text-base p-2"
                      placeholder="Expense Name"
                      aria-label="Expense Name"
                    />
                    <div className="flex justify-between items-center gap-4">
                        <div className="flex items-center gap-2 bg-gray-800/50 px-3 py-2 rounded-lg border border-white/5 flex-1 md:flex-none">
                        <span className="text-gray-500 text-sm">$</span>
                        <input 
                            type="number" 
                            value={item.amount}
                            onChange={(e) => handleUpdateExpense(item.id, 'amount', e.target.value)}
                            className="bg-transparent border-none text-white focus:ring-0 w-full md:w-24 text-right font-bold tabular-nums text-base"
                            placeholder="0.00"
                            aria-label="Expense Amount"
                        />
                        </div>
                        <button 
                        onClick={() => handleRemoveExpense(item.id)}
                        className="text-gray-600 hover:text-red-400 transition-colors p-2"
                        aria-label="Remove Expense"
                        >
                        <Trash2 size={20} />
                        </button>
                    </div>
                  </div>
                ))}
                 {expenses.length === 0 && (
                  <div className="text-center py-8 text-gray-500 italic text-sm border-2 border-dashed border-gray-800 rounded-xl">
                    No expenses logged.
                  </div>
                )}
              </div>
            </section>

          </div>

          {/* RIGHT: Tax Controller & Visuals */}
          <div className="space-y-6">
            
            {/* Tax Rate Controller */}
            <div className="bg-[#111827] border border-white/10 rounded-2xl p-6 sticky top-28">
              <h3 className="text-lg font-bold text-white mb-6 flex items-center gap-2">
                <PieChart size={20} className="text-[#2DD4BF]" /> 
                Tax Configuration
              </h3>

              <div className="mb-8">
                <div className="flex justify-between mb-2">
                  <label htmlFor="tax-slider" className="text-sm text-gray-400 font-semibold">Effective Tax Rate</label>
                  <span className="text-sm font-bold text-[#2DD4BF]">{taxRate}%</span>
                </div>
                <input 
                  id="tax-slider"
                  type="range" 
                  min="0" 
                  max="50" 
                  value={taxRate} 
                  onChange={(e) => setTaxRate(Number(e.target.value))}
                  className="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-teal-400 touch-manipulation"
                  aria-label="Tax Rate Slider"
                />
                <div className="flex justify-between mt-2 text-xs text-gray-600">
                  <span>Tax Exempt (0%)</span>
                  <span>Corp (21%)</span>
                  <span>High (50%)</span>
                </div>
              </div>

              <div className="space-y-4">
                <div className="p-4 rounded-xl bg-[#0A091B] border border-white/5">
                  <p className="text-xs text-gray-500 uppercase tracking-wide font-bold">Taxable Income</p>
                  <p className="text-xl font-bold text-white mt-1">{formatCurrency(Math.max(grossProfit, 0))}</p>
                </div>
                
                <div className="p-4 rounded-xl bg-[#0A091B] border border-white/5">
                  <p className="text-xs text-gray-500 uppercase tracking-wide font-bold">Tax Liability</p>
                  <p className="text-xl font-bold text-red-400 mt-1">{formatCurrency(taxAmount)}</p>
                </div>
              </div>

              {/* Simple Visual Breakdown */}
              <div className="mt-8 pt-8 border-t border-white/5">
                <p className="text-sm font-bold text-white mb-4">Distribution</p>
                <div className="flex h-4 rounded-full overflow-hidden w-full">
                  <div style={{ width: `${(taxAmount/totalIncome)*100}%` }} className="bg-gray-600" title="Tax"></div>
                  <div style={{ width: `${(totalExpenses/totalIncome)*100}%` }} className="bg-red-500" title="Expenses"></div>
                  <div style={{ width: `${(netProfit/totalIncome)*100}%` }} className="bg-[#2DD4BF]" title="Profit"></div>
                </div>
                <div className="flex items-center gap-4 mt-3 justify-center text-xs text-gray-400">
                  <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-red-500"></div> Exp</div>
                  <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-gray-600"></div> Tax</div>
                  <div className="flex items-center gap-1"><div className="w-2 h-2 rounded-full bg-[#2DD4BF]"></div> Profit</div>
                </div>
              </div>

            </div>

          </div>
        </div>

      </main>
    </div>
  );
}
